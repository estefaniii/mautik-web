"use strict";
"use client";
Object.defineProperty(exports, "__esModule", { value: true });
exports.default = AnalyticsPage;
const jsx_runtime_1 = require("react/jsx-runtime");
const react_1 = require("react");
const card_1 = require("@/components/ui/card");
const badge_1 = require("@/components/ui/badge");
const button_1 = require("@/components/ui/button");
const select_1 = require("@/components/ui/select");
const recharts_1 = require("recharts");
const lucide_react_1 = require("lucide-react");
const skeleton_1 = require("@/components/ui/skeleton");
function AnalyticsPage() {
    const [analytics, setAnalytics] = (0, react_1.useState)(null);
    const [loading, setLoading] = (0, react_1.useState)(true);
    const [timeRange, setTimeRange] = (0, react_1.useState)("30");
    (0, react_1.useEffect)(() => {
        fetchAnalytics();
    }, [timeRange]);
    const fetchAnalytics = async () => {
        try {
            setLoading(true);
            const response = await fetch(`/api/analytics?days=${timeRange}`);
            if (response.ok) {
                const data = await response.json();
                setAnalytics(data);
            }
        }
        catch (error) {
            console.error('Error fetching analytics:', error);
        }
        finally {
            setLoading(false);
        }
    };
    const formatCurrency = (amount) => {
        return new Intl.NumberFormat('es-PA', {
            style: 'currency',
            currency: 'USD'
        }).format(amount);
    };
    const formatGrowth = (growth) => {
        const isPositive = growth >= 0;
        return ((0, jsx_runtime_1.jsxs)("div", { className: `flex items-center ${isPositive ? 'text-green-600' : 'text-red-600'}`, children: [isPositive ? (0, jsx_runtime_1.jsx)(lucide_react_1.TrendingUp, { className: "h-4 w-4 mr-1" }) : (0, jsx_runtime_1.jsx)(lucide_react_1.TrendingDown, { className: "h-4 w-4 mr-1" }), (0, jsx_runtime_1.jsxs)("span", { className: "font-semibold", children: [Math.abs(growth).toFixed(1), "%"] })] }));
    };
    if (loading) {
        return ((0, jsx_runtime_1.jsxs)("div", { className: "container mx-auto px-4 py-8", children: [(0, jsx_runtime_1.jsxs)("div", { className: "flex justify-between items-center mb-8", children: [(0, jsx_runtime_1.jsxs)("div", { children: [(0, jsx_runtime_1.jsx)(skeleton_1.Skeleton, { className: "h-8 w-48 mb-2" }), (0, jsx_runtime_1.jsx)(skeleton_1.Skeleton, { className: "h-4 w-64" })] }), (0, jsx_runtime_1.jsx)(skeleton_1.Skeleton, { className: "h-10 w-32" })] }), (0, jsx_runtime_1.jsx)("div", { className: "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8", children: [...Array(4)].map((_, i) => ((0, jsx_runtime_1.jsxs)(card_1.Card, { children: [(0, jsx_runtime_1.jsxs)(card_1.CardHeader, { className: "flex flex-row items-center justify-between space-y-0 pb-2", children: [(0, jsx_runtime_1.jsx)(skeleton_1.Skeleton, { className: "h-4 w-24" }), (0, jsx_runtime_1.jsx)(skeleton_1.Skeleton, { className: "h-4 w-4" })] }), (0, jsx_runtime_1.jsxs)(card_1.CardContent, { children: [(0, jsx_runtime_1.jsx)(skeleton_1.Skeleton, { className: "h-8 w-20 mb-2" }), (0, jsx_runtime_1.jsx)(skeleton_1.Skeleton, { className: "h-4 w-16" })] })] }, i))) }), (0, jsx_runtime_1.jsxs)("div", { className: "grid grid-cols-1 lg:grid-cols-2 gap-8", children: [(0, jsx_runtime_1.jsxs)(card_1.Card, { children: [(0, jsx_runtime_1.jsx)(card_1.CardHeader, { children: (0, jsx_runtime_1.jsx)(skeleton_1.Skeleton, { className: "h-6 w-32" }) }), (0, jsx_runtime_1.jsx)(card_1.CardContent, { children: (0, jsx_runtime_1.jsx)(skeleton_1.Skeleton, { className: "h-64 w-full" }) })] }), (0, jsx_runtime_1.jsxs)(card_1.Card, { children: [(0, jsx_runtime_1.jsx)(card_1.CardHeader, { children: (0, jsx_runtime_1.jsx)(skeleton_1.Skeleton, { className: "h-6 w-32" }) }), (0, jsx_runtime_1.jsx)(card_1.CardContent, { children: (0, jsx_runtime_1.jsx)("div", { className: "space-y-4", children: [...Array(5)].map((_, i) => ((0, jsx_runtime_1.jsxs)("div", { className: "flex items-center space-x-4", children: [(0, jsx_runtime_1.jsx)(skeleton_1.Skeleton, { className: "h-12 w-12 rounded" }), (0, jsx_runtime_1.jsxs)("div", { className: "flex-1", children: [(0, jsx_runtime_1.jsx)(skeleton_1.Skeleton, { className: "h-4 w-32 mb-1" }), (0, jsx_runtime_1.jsx)(skeleton_1.Skeleton, { className: "h-3 w-24" })] }), (0, jsx_runtime_1.jsx)(skeleton_1.Skeleton, { className: "h-4 w-16" })] }, i))) }) })] })] })] }));
    }
    if (!analytics) {
        return ((0, jsx_runtime_1.jsx)("div", { className: "container mx-auto px-4 py-8", children: (0, jsx_runtime_1.jsxs)("div", { className: "text-center", children: [(0, jsx_runtime_1.jsx)("h1", { className: "text-2xl font-bold text-gray-900 mb-4", children: "Error al cargar analytics" }), (0, jsx_runtime_1.jsx)(button_1.Button, { onClick: fetchAnalytics, children: "Reintentar" })] }) }));
    }
    return ((0, jsx_runtime_1.jsxs)("div", { className: "container mx-auto px-4 py-8", children: [(0, jsx_runtime_1.jsxs)("div", { className: "flex justify-between items-center mb-8", children: [(0, jsx_runtime_1.jsxs)("div", { children: [(0, jsx_runtime_1.jsx)("h1", { className: "text-3xl font-bold text-gray-900", children: "Analytics" }), (0, jsx_runtime_1.jsx)("p", { className: "text-gray-600", children: "M\u00E9tricas y reportes de ventas" })] }), (0, jsx_runtime_1.jsxs)(select_1.Select, { value: timeRange, onValueChange: setTimeRange, children: [(0, jsx_runtime_1.jsx)(select_1.SelectTrigger, { className: "w-32", children: (0, jsx_runtime_1.jsx)(select_1.SelectValue, {}) }), (0, jsx_runtime_1.jsxs)(select_1.SelectContent, { children: [(0, jsx_runtime_1.jsx)(select_1.SelectItem, { value: "7", children: "7 d\u00EDas" }), (0, jsx_runtime_1.jsx)(select_1.SelectItem, { value: "30", children: "30 d\u00EDas" }), (0, jsx_runtime_1.jsx)(select_1.SelectItem, { value: "90", children: "90 d\u00EDas" })] })] })] }), (0, jsx_runtime_1.jsxs)("div", { className: "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8", children: [(0, jsx_runtime_1.jsxs)(card_1.Card, { children: [(0, jsx_runtime_1.jsxs)(card_1.CardHeader, { className: "flex flex-row items-center justify-between space-y-0 pb-2", children: [(0, jsx_runtime_1.jsx)(card_1.CardTitle, { className: "text-sm font-medium", children: "Ingresos Totales" }), (0, jsx_runtime_1.jsx)(lucide_react_1.DollarSign, { className: "h-4 w-4 text-muted-foreground" })] }), (0, jsx_runtime_1.jsxs)(card_1.CardContent, { children: [(0, jsx_runtime_1.jsx)("div", { className: "text-2xl font-bold", children: formatCurrency(analytics.totalRevenue) }), (0, jsx_runtime_1.jsxs)("p", { className: "text-xs text-muted-foreground", children: [formatGrowth(analytics.revenueGrowth), " vs per\u00EDodo anterior"] })] })] }), (0, jsx_runtime_1.jsxs)(card_1.Card, { children: [(0, jsx_runtime_1.jsxs)(card_1.CardHeader, { className: "flex flex-row items-center justify-between space-y-0 pb-2", children: [(0, jsx_runtime_1.jsx)(card_1.CardTitle, { className: "text-sm font-medium", children: "\u00D3rdenes" }), (0, jsx_runtime_1.jsx)(lucide_react_1.ShoppingCart, { className: "h-4 w-4 text-muted-foreground" })] }), (0, jsx_runtime_1.jsxs)(card_1.CardContent, { children: [(0, jsx_runtime_1.jsx)("div", { className: "text-2xl font-bold", children: analytics.totalOrders }), (0, jsx_runtime_1.jsx)("p", { className: "text-xs text-muted-foreground", children: "Total de pedidos" })] })] }), (0, jsx_runtime_1.jsxs)(card_1.Card, { children: [(0, jsx_runtime_1.jsxs)(card_1.CardHeader, { className: "flex flex-row items-center justify-between space-y-0 pb-2", children: [(0, jsx_runtime_1.jsx)(card_1.CardTitle, { className: "text-sm font-medium", children: "Ticket Promedio" }), (0, jsx_runtime_1.jsx)(lucide_react_1.DollarSign, { className: "h-4 w-4 text-muted-foreground" })] }), (0, jsx_runtime_1.jsxs)(card_1.CardContent, { children: [(0, jsx_runtime_1.jsx)("div", { className: "text-2xl font-bold", children: formatCurrency(analytics.averageOrderValue) }), (0, jsx_runtime_1.jsx)("p", { className: "text-xs text-muted-foreground", children: "Por orden" })] })] }), (0, jsx_runtime_1.jsxs)(card_1.Card, { children: [(0, jsx_runtime_1.jsxs)(card_1.CardHeader, { className: "flex flex-row items-center justify-between space-y-0 pb-2", children: [(0, jsx_runtime_1.jsx)(card_1.CardTitle, { className: "text-sm font-medium", children: "Productos Top" }), (0, jsx_runtime_1.jsx)(lucide_react_1.Eye, { className: "h-4 w-4 text-muted-foreground" })] }), (0, jsx_runtime_1.jsxs)(card_1.CardContent, { children: [(0, jsx_runtime_1.jsx)("div", { className: "text-2xl font-bold", children: analytics.topProducts.length }), (0, jsx_runtime_1.jsx)("p", { className: "text-xs text-muted-foreground", children: "M\u00E1s vendidos" })] })] })] }), (0, jsx_runtime_1.jsxs)("div", { className: "grid grid-cols-1 lg:grid-cols-2 gap-8", children: [(0, jsx_runtime_1.jsxs)(card_1.Card, { children: [(0, jsx_runtime_1.jsxs)(card_1.CardHeader, { children: [(0, jsx_runtime_1.jsx)(card_1.CardTitle, { children: "Ventas Mensuales" }), (0, jsx_runtime_1.jsxs)(card_1.CardDescription, { children: ["Ingresos por d\u00EDa en los \u00FAltimos ", timeRange, " d\u00EDas"] })] }), (0, jsx_runtime_1.jsx)(card_1.CardContent, { children: (0, jsx_runtime_1.jsx)(recharts_1.ResponsiveContainer, { width: "100%", height: 300, children: (0, jsx_runtime_1.jsxs)(recharts_1.LineChart, { data: analytics.monthlySales, children: [(0, jsx_runtime_1.jsx)(recharts_1.CartesianGrid, { strokeDasharray: "3 3" }), (0, jsx_runtime_1.jsx)(recharts_1.XAxis, { dataKey: "date", tickFormatter: (value) => new Date(value).toLocaleDateString('es-PA', { day: '2-digit', month: '2-digit' }) }), (0, jsx_runtime_1.jsx)(recharts_1.YAxis, { tickFormatter: (value) => `$${value}` }), (0, jsx_runtime_1.jsx)(recharts_1.Tooltip, { formatter: (value) => [formatCurrency(value), 'Ingresos'], labelFormatter: (label) => new Date(label).toLocaleDateString('es-PA') }), (0, jsx_runtime_1.jsx)(recharts_1.Line, { type: "monotone", dataKey: "revenue", stroke: "#8b5cf6", strokeWidth: 2 })] }) }) })] }), (0, jsx_runtime_1.jsxs)(card_1.Card, { children: [(0, jsx_runtime_1.jsxs)(card_1.CardHeader, { children: [(0, jsx_runtime_1.jsx)(card_1.CardTitle, { children: "Productos M\u00E1s Vendidos" }), (0, jsx_runtime_1.jsx)(card_1.CardDescription, { children: "Top 10 productos por ventas" })] }), (0, jsx_runtime_1.jsx)(card_1.CardContent, { children: (0, jsx_runtime_1.jsx)("div", { className: "space-y-4", children: analytics.topProducts.slice(0, 10).map((item) => {
                                        var _a, _b;
                                        return ((0, jsx_runtime_1.jsxs)("div", { className: "flex items-center space-x-4", children: [(0, jsx_runtime_1.jsx)("div", { className: "flex-shrink-0", children: (0, jsx_runtime_1.jsx)(badge_1.Badge, { variant: "secondary", className: "w-8 h-8 flex items-center justify-center", children: item.rank }) }), (0, jsx_runtime_1.jsxs)("div", { className: "flex-1 min-w-0", children: [(0, jsx_runtime_1.jsx)("p", { className: "text-sm font-medium text-gray-900 truncate", children: ((_a = item.product) === null || _a === void 0 ? void 0 : _a.name) || 'Producto no encontrado' }), (0, jsx_runtime_1.jsx)("p", { className: "text-xs text-gray-500", children: ((_b = item.product) === null || _b === void 0 ? void 0 : _b.category) || 'Sin categoría' })] }), (0, jsx_runtime_1.jsxs)("div", { className: "text-right", children: [(0, jsx_runtime_1.jsxs)("p", { className: "text-sm font-medium text-gray-900", children: [item._sum.sales, " vendidos"] }), (0, jsx_runtime_1.jsx)("p", { className: "text-xs text-gray-500", children: formatCurrency(item._sum.revenue) })] })] }, item.productId));
                                    }) }) })] })] })] }));
}
